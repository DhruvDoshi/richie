<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Configuring LMS Backends · Richie</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Richie can be connected to one or more OpenEdX Learning Management Systems (LMS) for a seamless"/><meta name="docsearch:version" content="2.9.1"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Configuring LMS Backends · Richie"/><meta property="og:type" content="website"/><meta property="og:url" content="https://richie.education/"/><meta property="og:description" content="Richie can be connected to one or more OpenEdX Learning Management Systems (LMS) for a seamless"/><meta property="og:image" content="https://richie.education/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://richie.education/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><h2 class="headerTitle">Richie</h2></a><a href="/versions"><h3>2.9.1</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/" target="_self">Home</a></li><li class=""><a href="https://github.com/openfun/richie" target="_self">GitHub</a></li><li class=""><a href="/docs/2.9.1/discover" target="_self">Documentation</a></li><li class=""><a href="/help" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Configuring LMS Backends</h1></header><article><div><span><p>Richie can be connected to one or more OpenEdX Learning Management Systems (LMS) for a seamless
experience between browsing the course catalog on Richie, enrolling to a course and following the
course itself on the LMS.</p>
<p>It is possible to do the same with Moodle or any other LMS exposing an enrollment API, at the
cost of writing a custom LMS handler backend.</p>
<h2><a class="anchor" aria-hidden="true" id="prerequisites"></a><a href="#prerequisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prerequisites</h2>
<p>This connection requires that Richie and OpenEdX be hosted on sibling domains i.e. domains that
are both subdomains of the same root domain, e.g. <code>richie.example.com</code> and <code>lms.example.com</code>.</p>
<p>OpenEdX will need to generate a CORS CSRF Cookie and this cookie is flagged as secure, which
implies that we are not able to use it without SSL connections.</p>
<p>As a consequence, you need to configure your OpenEdX instance as follows:</p>
<pre><code class="hljs css language-python">FEATURES = {
    ...
    <span class="hljs-string">"ENABLE_CORS_HEADERS"</span>: <span class="hljs-literal">True</span>,
    <span class="hljs-string">"ENABLE_CROSS_DOMAIN_CSRF_COOKIE"</span>: <span class="hljs-literal">True</span>,
}

CORS_ALLOW_CREDENTIALS = <span class="hljs-literal">True</span>
CORS_ALLOW_INSECURE = <span class="hljs-literal">False</span>
CORS_ORIGIN_WHITELIST: [<span class="hljs-string">"richie.example.com"</span>]  <span class="hljs-comment"># The domain on which Richie is hosted</span>

CROSS_DOMAIN_CSRF_COOKIE_DOMAIN = <span class="hljs-string">".example.com"</span>  <span class="hljs-comment"># The parent domain shared by Richie and OpenEdX</span>
CROSS_DOMAIN_CSRF_COOKIE_NAME: <span class="hljs-string">"edx_csrf_token"</span>
SESSION_COOKIE_NAME: <span class="hljs-string">"edx_session"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="configuring-the-lms-handler"></a><a href="#configuring-the-lms-handler" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuring the LMS handler</h2>
<p>The <code>LMSHandler</code> utility acts as a proxy that routes queries to the correct LMS backend API,
based on a regex match on the URL of the course. It is configured via the <code>RICHIE_LMS_BACKENDS</code>
setting. As an example, here is how it would be configured to connect to an Ironwood OpenEdX
instance hosted on <code>https://lms.example.com</code>:</p>
<pre><code class="hljs css language-python">RICHIE_LMS_BACKENDS=[
    {
        <span class="hljs-string">"BASE_URL"</span>: <span class="hljs-string">"https://lms.example.com"</span>,
        <span class="hljs-comment"># Django</span>
        <span class="hljs-string">"BACKEND"</span>: <span class="hljs-string">"richie.apps.courses.lms.edx.EdXLMSBackend"</span>,
        <span class="hljs-string">"COURSE_REGEX"</span>: <span class="hljs-string">r"^https://lms\.example\.com/courses/(?P&lt;course_id&gt;.*)/course/?$"</span>,
        <span class="hljs-comment"># ReactJS</span>
        <span class="hljs-string">"JS_BACKEND"</span>: <span class="hljs-string">"openedx-hawthorn"</span>,
        <span class="hljs-string">"JS_COURSE_REGEX"</span>: <span class="hljs-string">r"^https://lms\.example\.com/courses/(.*)/course/?$"</span>,
        <span class="hljs-comment"># Course runs synchronization</span>
        <span class="hljs-string">"COURSE_RUN_SYNC_NO_UPDATE_FIELDS"</span>: [],
        <span class="hljs-string">"DEFAULT_COURSE_RUN_SYNC_MODE"</span>: <span class="hljs-string">"sync_to_public"</span>,
    },
]
</code></pre>
<p>The following should help you understand how to configure this setting:</p>
<h3><a class="anchor" aria-hidden="true" id="base_url"></a><a href="#base_url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BASE_URL</h3>
<p>The base url on which the OpenEdX instance is hosted. This is used to construct the complete url
of the API endpoint on which the enrollment request is made by Richie's frontend application.</p>
<ul>
<li>Type: string</li>
<li>Required: Yes</li>
<li>Value: for example <a href="https://lms.example.com">https://lms.example.com</a></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="backend"></a><a href="#backend" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BACKEND</h3>
<p>The path to a Python class serving as LMS backend for the targeted LMS.</p>
<ul>
<li>Type: string</li>
<li>Required: Yes</li>
<li>Value: Richie ships with the following Python backends (custom backends can be written to fit
another specific LMS):
<ul>
<li><code>richie.apps.courses.lms.edx.EdXLMSBackend</code>: backend for OpenEdX</li>
<li><code>richie.apps.courses.lms.base.BaseLMSBackend</code>: fake backend for development purposes</li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="course_regex"></a><a href="#course_regex" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>COURSE_REGEX</h3>
<p>A Python regex that should match the course syllabus urls of the targeted LMS and return a
<code>course_id</code> named group on the id of the course extracted from these urls.</p>
<ul>
<li>Type: string</li>
<li>Required: Yes</li>
<li>Value: for example <code>^.*/courses/(?P&lt;course_id&gt;.*)/course/?$</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="js_backend"></a><a href="#js_backend" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS_BACKEND</h3>
<p>The name of the ReactJS backend to use for the targeted LMS.</p>
<ul>
<li>Type: string</li>
<li>Required: Yes</li>
<li>Value: Richie ships with the following Javascript backends (custom backends can be written to
fit another specific LMS):
<ul>
<li><code>openedx-dogwood</code>: backend for OpenEdX versions equal to <code>dogwood</code> or <code>eucalyptus</code></li>
<li><code>openedx-hawthorn</code>: backend for OpenEdX versions equal to <code>hawthorn</code> or higher</li>
<li><code>openedx-fonzie</code>: backend for OpenEdX via <a href="https://github.com/openfun/fonzie">Fonzie</a>
(extra user info and JWT tokens)</li>
<li><code>base</code>: fake backend for development purposes</li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="js_course_regex"></a><a href="#js_course_regex" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS_COURSE_REGEX</h3>
<p>A Javascript regex that should match the course syllabus urls of the targeted LMS and return an
unnamed group on the id of the course extracted from these urls.</p>
<ul>
<li>Type: string</li>
<li>Required: Yes</li>
<li>Value: for example <code>^.*/courses/(.*)/course/?$</code></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="default_course_run_sync_mode"></a><a href="#default_course_run_sync_mode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DEFAULT_COURSE_RUN_SYNC_MODE</h3>
<p>When a course run is created, this setting is used to set the value of the <code>sync_mode</code> field.
This value defines how the course runs synchronization script will impact this course run after
creation.</p>
<ul>
<li>Type: enum(string)</li>
<li>Required: No</li>
<li>Value: possible values are <code>manual</code>, <code>sync_to_draft</code> and <code>sync_to_public</code>
<ul>
<li><code>manual</code>: this course run is ignored by the course runs synchronization script</li>
<li><code>sync_to_draft</code>: only the draft version of this course run is synchronized. A manual
publication is necessary for the update to be visible on the public site.</li>
<li><code>sync_to_public</code>: the public version of this course run is updated by the synchronization
script. As a results, updates are directly visible on the public site without further
publication by a staff user in Richie.</li>
</ul></li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="course_run_sync_no_update_fields"></a><a href="#course_run_sync_no_update_fields" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>COURSE_RUN_SYNC_NO_UPDATE_FIELDS</h3>
<p>A list of fields that must only be set the first time a course run is synchronized. During this
first synchronization, a new course run is created in Richie and all fields sent to the API
endpoint via the payload are set on the object. For subsequent synchronization calls, the fields
listed in this setting are ignored and not synchronized. This can be used to allow modifying some
fields manually in Richie regardless of what OpenEdX sends after an initial value is set.</p>
<p>Note that this setting is only effective for course runs with the <code>sync_mode</code> field set to a
value other then <code>manual</code>.</p>
<ul>
<li>Type: enum(string)</li>
<li>Required: No</li>
<li>Value: for example [&quot;languages&quot;]</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="technical-support"></a><a href="#technical-support" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Technical support</h2>
<p>If you encounter an issue with this documentation or the backends included in Richie, please
<a href="https://github.com/openfun/richie/issues">open an issue on our repository</a>.</p>
<p>If you need a custom backend, you can <a href="https://github.com/openfun/richie/pulls">submit a PR</a> or
<a href="https://github.com/openfun/richie/issues">open an issue</a> and we will consider adding it.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 6/16/2021</em></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#prerequisites">Prerequisites</a></li><li><a href="#configuring-the-lms-handler">Configuring the LMS handler</a><ul class="toc-headings"><li><a href="#base_url">BASE_URL</a></li><li><a href="#backend">BACKEND</a></li><li><a href="#course_regex">COURSE_REGEX</a></li><li><a href="#js_backend">JS_BACKEND</a></li><li><a href="#js_course_regex">JS_COURSE_REGEX</a></li><li><a href="#default_course_run_sync_mode">DEFAULT_COURSE_RUN_SYNC_MODE</a></li><li><a href="#course_run_sync_no_update_fields">COURSE_RUN_SYNC_NO_UPDATE_FIELDS</a></li></ul></li><li><a href="#technical-support">Technical support</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Documentation</h5><a href="/docs/discover.html">Getting Started</a><a href="/versions">Versions</a><a href="/docs/contributing.html">Contributing</a></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a><a href="https://github.com/openfun/richie">GitHub</a></div></section><section class="copyright">Creative Commons 2022 — Richie contributors / Illustrations Katerina Limpitsouni</section></footer></div></body></html>